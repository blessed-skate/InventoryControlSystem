create database ICSDB;

--DROP TABLE ICSDB.TACISUSER;

CREATE TABLE ICSDB.TACISUSER 
( 
  FIIDUSER INT(10) NOT NULL AUTO_INCREMENT
, FCUSERNAME VARCHAR(50) NOT NULL  
, FCPASSWORD VARCHAR(100) NOT NULL 
, FCAUTHORITY VARCHAR(50) NOT NULL 
, FCENABLED ENUM('1','0') NOT NULL  
, FCNAME VARCHAR(50) NOT NULL  
, FCLASTNAME VARCHAR(50)  
, FCSEX ENUM('M','F')  
, FDBIRTH DATE  
, FDREGISTERDATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
, FDLASTUPDATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP 
, CONSTRAINT PRIMARY KEY ( FIIDUSER ) );

CREATE UNIQUE INDEX TACISUSER_INDEX1 ON ICSDB.TACISUSER ( FIIDUSER ASC);

CREATE UNIQUE INDEX TACISUSER_INDEX2 ON ICSDB.TACISUSER ( FCUSERNAME ASC);

--DROP TABLE ICSDB.CTCISLEDGER;

CREATE TABLE ICSDB.CTCISLEDGER 
( 
  FIIDLEDGER INT(10) NOT NULL 
, FCSUBCLASS VARCHAR(2) NOT NULL 
, FCDESCRIPTION VARCHAR(100) NOT NULL 
, FDREGISTERDATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP 
, FDLASTUPDATE TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP 
, CONSTRAINT PRIMARY KEY ( FIIDLEDGER, FCSUBCLASS ) );

CREATE INDEX CTCISLEDGER_INDEX1 ON ICSDB.CTCISLEDGER ( FIIDLEDGER ASC, FCSUBCLASS ASC);

--DROP TABLE ICSDB.CTCISPROPERTY;

CREATE TABLE ICSDB.CTCISPROPERTY 
( 
  FCIDPROPERTY VARCHAR(30) NOT NULL
, FCVALUE VARCHAR(50) NOT NULL
, FCDEFAULT VARCHAR(50) NOT NULL 
, CONSTRAINT PRIMARY KEY ( FCIDPROPERTY ) );

CREATE INDEX CTCISPROPERTY_INDEX1 ON ICSDB.CTCISPROPERTY ( FCIDPROPERTY ASC);

--DROP TABLE ICSDB.TACISASSET;

CREATE TABLE ICSDB.TACISASSET 
( 
  FIIDASSET BIGINT(19) NOT NULL AUTO_INCREMENT
, FIIDLEDGER INT(10) NOT NULL 
, FCSUBCLASS VARCHAR(2) NOT NULL 
, FCDESCRIPTION VARCHAR(100) NOT NULL 
, FCBRAND VARCHAR(100) NULL DEFAULT 'Sin marca' 
, FCMODEL VARCHAR(100) NULL DEFAULT 'Sin modelo' 
, FCSERIALNUMBER VARCHAR(100) NULL DEFAULT 'Sin numero de serie' 
, FCMATERIAL VARCHAR(100) NULL 
, FCCOLOR VARCHAR(100) NULL 
, FCSUPPLIER VARCHAR(100) NULL DEFAULT 'Proveedor no identificado' 
, FCGENERALMANAGER VARCHAR(100) NULL 
, FCDIRECTLYRESPONSIBLE VARCHAR(100) NULL 
, FITAG BIGINT(19) NOT NULL 
, FCBILL VARCHAR(100) NULL DEFAULT 'Sin factura' 
, FDBILLINGDATE DATE NULL DEFAULT '2015-06-01' 
, FCLOCATION VARCHAR(100) NULL 
, FDUSEDATE DATE NULL DEFAULT '2015-06-01' 
, FNPRICE DECIMAL(10, 2) NOT NULL DEFAULT 0.00
, FCPLACE VARCHAR(100) NULL
, FCGENERALLOCATION VARCHAR(100) NULL 
, FCSECURE VARCHAR(100) NULL
, FCSTART VARCHAR(100) NULL
, FDREGISTERDATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP 
, FDLASTUPDATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
, CONSTRAINT PRIMARY KEY ( FIIDASSET ) );

ALTER TABLE ICSDB.TACISASSET ADD CONSTRAINT TACISASSET_FK1 FOREIGN KEY ( FIIDLEDGER, FCSUBCLASS )
 REFERENCES ICSDB.CTCISLEDGER ( FIIDLEDGER,  FCSUBCLASS );

CREATE UNIQUE INDEX TACISASSET_INDEX1 ON ICSDB.TACISASSET ( FIIDASSET ASC);

CREATE INDEX TACISASSET_INDEX2 ON ICSDB.TACISASSET ( FIIDLEDGER ASC, FCSUBCLASS ASC);

CREATE UNIQUE INDEX TACISASSET_INDEX3 ON ICSDB.TACISASSET ( FITAG ASC);

create user 'ICS_PORTAL_USER'@'localhost' IDENTIFIED BY 'p0rt4l_us3r';

GRANT SELECT, INSERT, UPDATE, DELETE ON ICSDB.TACISUSER TO CIS_PORTAL_USER;
GRANT SELECT, INSERT, UPDATE, DELETE ON ICSDB.TACISASSET TO CIS_PORTAL_USER;
GRANT SELECT, DELETE, UPDATE, INSERT ON ICSDB.CTCISLEDGER TO CIS_PORTAL_USER;
GRANT SELECT, DELETE, UPDATE, INSERT ON ICSDB.CTCISPROPERTY TO CIS_PORTAL_USER;
