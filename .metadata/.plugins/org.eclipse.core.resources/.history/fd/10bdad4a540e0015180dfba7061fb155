package mx.com.icsp.util.excel;

import java.io.IOException;

import javax.servlet.http.HttpServletResponse;
import javax.xml.parsers.ParserConfigurationException;

import mx.com.icsc.common.util.LogPattern;
import mx.com.icsp.util.Constants;

import org.apache.log4j.Logger;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.w3c.dom.DOMException;
import org.xml.sax.SAXException;


public class ExcelWriter{

	private Logger log = Logger.getLogger(this.getClass());
	private LogPattern logPattern = new LogPattern(Constants.domainCode,
			Constants.solutioNameCode, Constants.platform, Constants.tower,
			this.getClass().getName());
	
	private ExcelXmlParser parser;
	private int rows_stat;
	private Sheet sheet;
	private int headerOffset = 19;
	
	public void generate(String idTransaction, String xml, HttpServletResponse resp){
		
		String methodName = new Throwable().getStackTrace()[0].getMethodName();
		
		log.info(logPattern.buildPattern(methodName, idTransaction, "xml", xml));
		parser = new ExcelXmlParser();
		try {
			parser.setXML(xml);
			createExcel();
			rowsPrint(parser, resp);
		} catch (DOMException e) {
			log.error(logPattern.buildPattern(methodName, idTransaction, "DOMException", e.getMessage()), e);
		} catch (IOException e) {
			log.error(logPattern.buildPattern(methodName, idTransaction, "IOException", e.getMessage()), e);
		} catch (ParserConfigurationException e) {
			log.error(logPattern.buildPattern(methodName, idTransaction, "ParserConfigurationException", e.getMessage()), e);
		} catch (SAXException e) {
			log.error(logPattern.buildPattern(methodName, idTransaction, "SAXException", e.getMessage()), e);
		}
	
	}
	
	private void createExcel(HttpServletResponse resp) throws IOException {
		Workbook wb = new HSSFWorkbook();
		
		sheet = wb.createSheet("First Sheet", 0);
		colors = new RGBColor();
	}
	
	private void rowsPrint(ExcelXmlParser parser, HttpServletResponse resp) {
		//do we really need them?
		ExcelRow[] rows = parser.getGridContent();
	}
}
